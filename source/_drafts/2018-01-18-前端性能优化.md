title: 前端性能优化
date: 2018.01.18
tags: [性能]
categories: 前端
---
前端性能优化是一个老生常谈的问题，并且在面试的时候，这个题几乎是面试官非常喜欢的一道题。这篇文章主要是总结自己之前在移动端H5性能优化上的实践和思考。
<!--more-->
## 性能
我个人认为，对于H5来说，性能优化的点可以分为两大类：加载性能和渲染性能。加载性能越好，用户就能越快的看到页面，跳失率越低，从而收益越高。渲染性能决定了数据到达用户手机后能多块的展现，这一块其实还包括了交互性能。
### 加载性能
#### 静态资源加载
+ 速度。主要就是两点：减小体积、减少请求数。
  * js和css，目前正常的线上应用应该都会压缩代码、合并combo请求。理想是1个css、1个js请求。
  * 图片压缩。tiny.png是一个很好的在线压缩图片的地方。最好是能有一个公共库处理所有图片资源。最简单的比如安卓采用webp。如果cdn支持压缩参数，那必须根据网络环境、设备屏幕大小，来控制图片尺寸、压缩比例。
  * 域名收敛。由于目前移动端HTTP/2的支持率已经很高了，所以已经不需要分拆域名了，收敛域名反而能加快资源的加载。期望的效果是：图片一个域名，js和css一个域名、动态请求一个域名。
+ 优先级。
  * 如果是后端渲染的页面，那在dom渲染之前不应该出现任何js，因为渲染DOM的优先级是最高的。前端渲染的话那就另说。
  * css要在head中，但是在移动端要考虑首屏，所以如果css很多的话，需要考虑css分拆，在head中只加载首屏用到的css，非首屏的css可以在后面引入。
  * 减少不必要的DOM。最好的方案应该是首屏直出，后面的DOM用前端渲染。或者使用懒渲染。直出的页面只有占坑的DOM，随着滚动加载对应的DOM。或者对于需要接口数据来渲染的DOM，可以用js来渲染，而不是直接将全部DOM预设在HTML中，影响文档加载时间和DOM渲染时间。
  * 所有图片、视频都必须懒加载。无论是img标签还是背景图片，一律懒加载。因为不懒加载的话，非首屏的图片会在页面进入的时候，严重占用系统资源，影响首屏时间。图片懒加载需要考虑一个问题就是懒加载是由js触发的，所以其执行的时机一定要靠前，因为一开始进入页面的时候，首屏图片由于懒加载时也是没有加载渲染的，所以可以考虑把懒加载的相关逻辑代码直接内嵌在html中，并且在其他的js之前。让首屏的图片尽可能的快加载。如果页面是知道哪些资源是首屏的话，那首屏的图片就不要懒加载了。

### 渲染性能
渲染性能




## 参老资料
[chrome文档 分析运行时性能](https://developers.google.com/web/tools/chrome-devtools/rendering-tools/)
[Web性能优化](https://segmentfault.com/a/1190000008693178)
[chrome文档 使用 Lighthouse 审查网络应用](https://developers.google.com/web/tools/lighthouse/)
[淘宝FED Composite优化](http://taobaofed.org/blog/2016/04/25/performance-composite/)